#!/usr/bin/bash

#wget "https://proxylist.geonode.com/api/proxy-list?limit=500&page=2&sort_by=lastChecked&sort_type=desc"

: ${DIR=lists}

rm -vf proxy-list.*

set -ex

## 1) From https://proxylist.geonode.com/api/proxy-list?protocols=socks5&limit=500&page=1&sort_by=lastChecked&sort_type=desc
for page in {01..14}; do
	echo "Downloading page $page"
	wget "https://proxylist.geonode.com/api/proxy-list?limit=500&page=${page}&sort_by=lastChecked&sort_type=desc" -O "${DIR}/proxy-list.${page}.json"
done

## 2) From https://openproxy.space/list
curl -sS https://openproxy.space/list/socks4 \
	| grep -oP '(?<=data:)\[\{code.+}\](?=,added:)' \
		| sed -r 's/(code|added|items):/"\1":/g;s/(active|count):(\w+\b)/"\1": "\2"/g' \
			> "${DIR}/openproxy.space.socks4.json"
curl -sS https://openproxy.space/list/socks5 \
	| grep -oP '(?<=data:)\[\{code.+}\](?=,added:)' \
		| sed -r 's/(code|added|items):/"\1":/g;s/(active|count):(\w+\b)/"\1": "\2"/g' \
			> "${DIR}/openproxy.space.socks5.json"
curl -sS https://openproxy.space/list/http \
	| grep -oP '(?<=data:)\[\{code.+}\](?=,added:)' \
		| sed -r 's/(code|added|items):/"\1":/g;s/(active|count):(\w+\b)/"\1": "\2"/g' \
			> "${DIR}/openproxy.space.http.json"

## 3) https://free-proxy-list.net
curl -sS https://free-proxy-list.net \
	| grep -P '\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}:\d{2,5}' \
		> "${DIR}/free-proxy-list.net.http.txt"

## 4) https://proxybros.com/free-proxy-list/
## First POST required before GET!
curl -sS -X POST --data 'action=nrproxyexport&type=2&lang=en&path=%2Ffree-proxy-list%2F' \
	--header 'Cookie: pll_language=en; PHPSESSID=71e9e7593aca94c4667224441437d893' \
		https://proxybros.com/wp-admin/admin-ajax.php
curl -sS \
	--header 'Cookie: pll_language=en; PHPSESSID=71e9e7593aca94c4667224441437d893' \
		https://proxybros.com/wp-json/proxy_list/download \
			> "${DIR}/proxybros.com.json"

## 5) https://gologin.com/free-proxy/ (https://geoxy.io/)
curl -sS 'https://geoxy.io/proxies?count=99999' \
	-H 'Authorization: BgPXfhUc8CAhK7wGOqzqz9m77j3sH7' \
		> "${DIR}/geoxy.io.json"

echo DONE
